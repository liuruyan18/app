import{s as x,p as T,h as n,E as t,z as y}from"./index-CXCzEs_M.js";import{u as C,a as s}from"./Security-J1jS0fmJ.js";import{u as U}from"./douyin-OUNkm3AY.js";import{u as D}from"./bilibili-DFke89aa.js";const S=U(),v=D(),r=C(),A=x("user",()=>{const i=T(),u=n(!0),m=n(""),g=n(""),h=n(""),c=n({}),I=n([]),w=n([]),o=n(""),p=n("");function f(){c.value=JSON.parse(localStorage.getItem("u")||"{}")}function O(){localStorage.removeItem("u"),localStorage.removeItem("t"),c.value={},S.datas=[],v.datas=[],f(),S.getDouyinData(),v.getBilibiliData()}function J(){if(m.value==""||g.value==""){t.error("用户名或密码不能为空");return}s({method:"post",url:"/api/login.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({username:m.value,password:g.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(t.success(e.msg),localStorage.setItem("u",JSON.stringify(e.data)),localStorage.setItem("t",e.data.token),S.datas=[],v.datas=[],f(),S.getDouyinData(),v.getBilibiliData()),e.code==2&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})}function N(){if(m.value==""&&g.value==""&&h.value==""){t.error("用户名、密码、注册码不能为空");return}if(m.value.length<8||m.value.length>16){t.error("用户名的长度需要大于等于8小于等于16");return}if(g.value.length<8||g.value.length>16){t.error("密码的长度需要大于等于8小于等于16");return}s({method:"post",url:"/api/register.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({username:m.value,password:g.value,code:h.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(t.success(e.msg),u.value=!u.value),e.code==2&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})}return{islogin:u,username:m,password:g,code:h,userinfo:c,orderlist:I,codelist:w,quit:O,login:J,register:N,getUser:f,getUserInfo:()=>{if(o.value=localStorage.getItem("t"),localStorage.getItem("t")==null){localStorage.removeItem("u"),c.value={},u.value=!0;return}s({method:"post",url:"/api/userinfo.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(localStorage.setItem("u",JSON.stringify(e.data)),localStorage.setItem("t",e.data.token),c.value=JSON.parse(localStorage.getItem("u")||"{}")),e.code==2&&t.error(e.msg),e.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(e.msg),i.replace({name:"Me"}))}).catch(a=>{t.error("网络错误")})},Sign:()=>{if(o.value=localStorage.getItem("t"),p.value=(new Date().getTime()/1e3).toString(),localStorage.getItem("t")==null){localStorage.removeItem("u"),c.value={},u.value=!0;return}s({method:"post",url:"/api/sign.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,sign:p.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(localStorage.setItem("u",JSON.stringify(e.data)),localStorage.setItem("t",e.data.token),c.value=JSON.parse(localStorage.getItem("u")||"{}"),t.success(e.msg)),e.code==2&&t.error(e.msg),e.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(e.msg),i.replace({name:"Me"})),e.code==4&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})},redeemCard:a=>{if(o.value=localStorage.getItem("t"),localStorage.getItem("t")==null){localStorage.removeItem("u"),c.value={},u.value=!0;return}y.confirm("是否确认兑换等级卡，兑换后不可撤销。","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(()=>{s({method:"post",url:"/api/redeemcard.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,level:a}).toString())}}).then(e=>{let l=JSON.parse(r.decrypt(e.data));l.code==1&&(localStorage.setItem("u",JSON.stringify(l.data)),localStorage.setItem("t",l.data.token),c.value=JSON.parse(localStorage.getItem("u")||"{}"),S.datas=[],v.datas=[],f(),S.getDouyinData(),v.getBilibiliData()),l.code==2&&t.error(l.msg),l.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(l.msg),i.replace({name:"Me"})),l.code==4&&t.error(l.msg)}).catch(e=>{t.error("网络错误")})})},getOrder:()=>{o.value=localStorage.getItem("t"),p.value=(new Date().getTime()/1e3).toString(),s({method:"post",url:"/api/order.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,query:p.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(I.value=e.data),e.code==2&&t.error(e.msg),e.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(e.msg),i.replace({name:"Me"})),e.code==4&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})},postOrder:(a,e)=>{if(o.value=localStorage.getItem("t"),localStorage.getItem("t")==null){localStorage.removeItem("u"),c.value={},u.value=!0;return}if(a==""||a==null){t.error("订单编号或口令不能为空");return}if(e==""||e==null){t.error("平台不能为空");return}if(e=="淘宝"&&a.length!=19){t.error("淘宝订单号错误");return}if(e=="京东"&&a.length!=12){t.error("京东订单号错误");return}if(e=="口令红包"&&a.length<5){t.error("口令红包错误");return}s({method:"post",url:"/api/order.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,order:a,platform:e}).toString())}}).then(l=>{let d=JSON.parse(r.decrypt(l.data));d.code==1&&(I.value.push({platform:e,order:a,status:"待审核",dot:null,datetime:""}),t.success(d.msg)),d.code==2&&t.error(d.msg),d.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(d.msg),i.replace({name:"Me"})),d.code==4&&t.error(d.msg)}).catch(l=>{t.error("网络错误")})},getCode:()=>{o.value=localStorage.getItem("t"),p.value=(new Date().getTime()/1e3).toString(),s({method:"post",url:"/api/code.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,getcode:p.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&(w.value=e.data),e.code==2&&t.error(e.msg),e.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(e.msg),i.replace({name:"Me"})),e.code==4&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})},postCode:()=>{if(o.value=localStorage.getItem("t"),localStorage.getItem("t")==null){localStorage.removeItem("u"),c.value={},u.value=!0;return}y.confirm("是否兑换注册码，兑换后不可撤销。","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(()=>{s({method:"post",url:"/api/code.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:r.encrypt(new URLSearchParams({t:o.value,postcode:p.value}).toString())}}).then(a=>{let e=JSON.parse(r.decrypt(a.data));e.code==1&&w.value.push(e.data),e.code==2&&t.error(e.msg),e.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),t.error(e.msg),i.replace({name:"Me"})),e.code==4&&t.error(e.msg)}).catch(a=>{t.error("网络错误")})})}}});export{A as u};
