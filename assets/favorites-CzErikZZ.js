import{s as f,h as s,p as m,E as r}from"./index-CXCzEs_M.js";import{u as v,a as p}from"./Security-J1jS0fmJ.js";const u=v(),y=f("favorites",()=>{const e=s([]),a=s(""),c=s(0),l=s(!1),i=m();function n(){a.value=localStorage.getItem("t"),c.value=e.value.length,!l.value&&(l.value=!0,p({method:"post",url:"/api/favorites.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:u.encrypt(new URLSearchParams({t:a.value,page:c.value}).toString())}}).then(t=>{let o=JSON.parse(u.decrypt(t.data));o.code==1&&e.value.push(...o.data),o.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),r.error(o.msg),i.replace({name:"user"}))}).catch(t=>{r.error("网络错误")}).finally(()=>{l.value=!1}))}function g(t){if(a.value=localStorage.getItem("t"),localStorage.getItem("t")==null||localStorage.getItem("u")==null){r.error("请先登录"),i.replace({name:"user"});return}else{if(t.collect_count+=1,t.collectLoading)return;t.collectLoading=!0,setTimeout(()=>{t.collectLoading=!1},1e3),p({method:"post",url:"/api/favorites.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:u.encrypt(new URLSearchParams({t:a.value,category:t.category,video_id:t.id}).toString())}}).then(o=>{let d=JSON.parse(u.decrypt(o.data));d.code==1&&(e.value.unshift(t),r({message:d.msg,grouping:!0,type:"success",duration:800})),d.code==3&&(localStorage.removeItem("u"),localStorage.removeItem("t"),r.error(d.msg))}).catch(o=>{r.error("网络错误")})}}return{lists:e,getfavoritesData:n,addfavorites:g}}),w=f("favoritesitem",()=>{const e=s({});function a(c){e.value=c}return{item:e,setfavoritesItem:a}}),I=f("favoriteslist",()=>{const e=s([]),a=s("");function c(l){a.value=localStorage.getItem("t"),p({method:"post",url:"/api/videos_recommend.php",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{data:u.encrypt(new URLSearchParams({t:a.value,category:l.category,author:l.author}).toString())}}).then(i=>{let n=JSON.parse(u.decrypt(i.data));n.code==1&&(e.value=n.data),n.code==3&&r.error(n.msg)}).catch(i=>{r.error("网络错误")})}return{datas:e,getfavoritesData:c}});export{w as a,I as b,y as u};
